#ifndef SAX_H
#define SAX_H

#include <vector>
#include <functional>

std::vector<std::vector<char>> sax(const std::vector<double> &ts,
                                  const int window, const int stride,
                                  const int w, const int alpha);
std::vector<std::vector<double>> paa(const std::vector<double> &ts,
                                     const int window, const int stride,
                                     const int w);

void znorm(std::vector<double> &window_segment, const int window);
void discretise(std::vector<double> &window_segment, std::vector<char> &word,
                const int window, const int w, const int alpha);
void paa_window(std::vector<double> &window_segment,
                std::vector<double> &result_window, const int window,
                const int w);
void process_window(
    const std::vector<double> &window_segment,
    int window, int w,
    const std::function<void(double, int)> &on_symbol_complete);

constexpr double EPSILON = 1e-6;

const std::vector<std::vector<double>> breakpoints{
    {},
    {}, // alpha = 0 and alpha = 1 are invalid
    {0.0},
    {-0.43072729929545756, 0.43072729929545744},
    {-0.6744897501960817, 0.0, 0.6744897501960817},
    {-0.8416212335729142, -0.2533471031357997, 0.2533471031357997,
     0.8416212335729143},
    {-0.967421566101701, -0.43072729929545756, 0.0, 0.43072729929545744,
     0.967421566101701},
    {-1.0675705238781414, -0.5659488219328631, -0.1800123697927051,
     0.18001236979270496, 0.5659488219328631, 1.0675705238781412},
    {-1.1503493803760079, -0.6744897501960817, -0.31863936396437514, 0.0,
     0.31863936396437514, 0.6744897501960817, 1.1503493803760079},
    {-1.22064034884735, -0.7647096737863871, -0.43072729929545756,
     -0.13971029888186212, 0.13971029888186212, 0.43072729929545744,
     0.7647096737863871, 1.2206403488473496},
    {-1.2815515655446004, -0.8416212335729142, -0.5244005127080409,
     -0.2533471031357997, 0.0, 0.2533471031357997, 0.5244005127080407,
     0.8416212335729143, 1.2815515655446004},
    {-1.335177736118937, -0.9084578685373851, -0.6045853465832371,
     -0.3487556955170447, -0.11418529432142838, 0.11418529432142824,
     0.3487556955170447, 0.6045853465832371, 0.9084578685373853,
     1.3351777361189363},
    {-1.382994127100638, -0.967421566101701, -0.6744897501960817,
     -0.43072729929545756, -0.2104283942479247, 0.0, 0.21042839424792484,
     0.43072729929545744, 0.6744897501960817, 0.967421566101701,
     1.382994127100638},
    {-1.4260768722728474, -1.0200762327862014, -0.7363159173761294,
     -0.5024022233733555, -0.29338123212119327, -0.09655861528963908,
     0.09655861528963908, 0.29338123212119344, 0.5024022233733555,
     0.7363159173761297, 1.0200762327862014, 1.4260768722728474},
    {-1.465233792685523, -1.0675705238781414, -0.7916386077433746,
     -0.5659488219328631, -0.36610635680056963, -0.1800123697927051, 0.0,
     0.18001236979270496, 0.3661063568005698, 0.5659488219328631,
     0.7916386077433746, 1.0675705238781412, 1.465233792685523},
    {-1.501085946044025, -1.1107716166367854, -0.8416212335729142,
     -0.6229257232100878, -0.43072729929545756, -0.2533471031357997,
     -0.08365173390712909, 0.08365173390712909, 0.2533471031357997,
     0.43072729929545744, 0.6229257232100877, 0.8416212335729143,
     1.1107716166367854, 1.501085946044025},
    {-1.5341205443525463, -1.1503493803760079, -0.887146559018876,
     -0.6744897501960817, -0.4887764111146695, -0.31863936396437514,
     -0.1573106846101707, 0.0, 0.1573106846101707, 0.31863936396437514,
     0.4887764111146695, 0.6744897501960817, 0.887146559018876,
     1.1503493803760079, 1.5341205443525463},
    {-1.5647264713617988, -1.1868314327558185, -0.9288994916472707,
     -0.7215222839823433, -0.5413950851290877, -0.37739194382855384,
     -0.2230078309403668, -0.07379127380827269, 0.07379127380827269,
     0.2230078309403668, 0.37739194382855396, 0.541395085129088,
     0.7215222839823432, 0.9288994916472707, 1.1868314327558185,
     1.5647264713617985},
    {-1.5932188180230507, -1.22064034884735, -0.967421566101701,
     -0.7647096737863871, -0.5894557978497783, -0.43072729929545756,
     -0.28221614706250814, -0.13971029888186212, 0.0, 0.13971029888186212,
     0.28221614706250825, 0.43072729929545744, 0.5894557978497783,
     0.7647096737863871, 0.967421566101701, 1.2206403488473496,
     1.59321881802305},
    {-1.6198562586382699, -1.2521195202652196, -1.0031479676625337,
     -0.8045963803603002, -0.6336400007797011, -0.4795056533309502,
     -0.33603814037182317, -0.199201324789267, -0.06601181237584074,
     0.0660118123758406, 0.199201324789267, 0.33603814037182306,
     0.4795056533309502, 0.633640000779701, 0.8045963803603002,
     1.0031479676625337, 1.2521195202652196, 1.6198562586382697},
    {-1.6448536269514729, -1.2815515655446004, -1.0364333894937898,
     -0.8416212335729142, -0.6744897501960817, -0.5244005127080409,
     -0.38532046640756773, -0.2533471031357997, -0.12566134685507402, 0.0,
     0.12566134685507416, 0.2533471031357997, 0.38532046640756773,
     0.5244005127080407, 0.6744897501960817, 0.8416212335729143,
     1.0364333894937898, 1.2815515655446004, 1.6448536269514722},
    {-1.6683911939470795,  -1.309171716785777,   -1.0675705238781414,
     -0.8761428492468408,  -0.712443032389489,   -0.5659488219328631,
     -0.43072729929545756, -0.30298044805620655, -0.1800123697927051,
     -0.05971709978532289, 0.05971709978532289,  0.18001236979270496,
     0.30298044805620655,  0.43072729929545744,  0.5659488219328631,
     0.7124430323894889,   0.8761428492468408,   1.0675705238781412,
     1.309171716785777,    1.668391193947079},
    {-1.6906216295848977,
     -1.335177736118937,
     -1.0968035620935135,
     -0.9084578685373851,
     -0.7478585947633022,
     -0.6045853465832371,
     -0.4727891209922674,
     -0.3487556955170447,
     -0.22988411757923205,
     -0.11418529432142838,
     0.0,
     0.11418529432142824,
     0.2298841175792322,
     0.3487556955170447,
     0.4727891209922672,
     0.6045853465832371,
     0.7478585947633022,
     0.9084578685373853,
     1.0968035620935135,
     1.3351777361189363,
     1.6906216295848986},
    {-1.7116753065097285, -1.3597373839386062,  -1.1243382315686392,
     -0.9388143168769032, -0.7810338115227088,  -0.6406668899191049,
     -0.5119362138713294, -0.39119625818947174, -0.2759210631079599,
     -0.164210777079331,  -0.05451891484810106, 0.05451891484810106,
     0.16421077707933085, 0.27592106310796005,  0.39119625818947174,
     0.5119362138713294,  0.6406668899191048,   0.7810338115227088,
     0.9388143168769032,  1.1243382315686385,   1.3597373839386055,
     1.7116753065097288},
    {-1.731664396122245,  -1.382994127100638,   -1.1503493803760079,
     -0.967421566101701,  -0.8122178014999129,  -0.6744897501960817,
     -0.5485222826980979, -0.43072729929545756, -0.31863936396437514,
     -0.2104283942479247, -0.1046334556140754,  0.0,
     0.10463345561407526, 0.21042839424792484,  0.31863936396437514,
     0.43072729929545744, 0.5485222826980981,   0.6744897501960817,
     0.8122178014999129,  0.967421566101701,    1.1503493803760079,
     1.382994127100638,   1.7316643961222453}};

#endif
